@using Microsoft.AspNetCore.Identity
@using BallerScout.Entities
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@inject BallerScout.Service.ServiceInterfaces.ISavedPostService SavedPostService
@inject BallerScout.Service.ServiceInterfaces.IUploadImageService UploadImageService


@model BallerScout.Entities.Post

<div class="col-12 text-center p-5">
    <div class="row d-flex text-center w-75">
        <img src="~/ProfilePhotos/@Model.UserProfilePhoto" class="profile-img" />
        @if (UserManager.GetUserId(User) == @Model.UserId)
        {
            <a asp-area="Identity" asp-page="/Account/Manage/Index">@Html.DisplayFor(model => model.UserName)</a>
        }
        else
        {
            <a asp-action="UserProfile" asp-controller="User" asp-route-id="@Model.UserId">@Html.DisplayFor(model => model.UserName)</a>
        }
    </div>
    @if (Model.PhotoUrl != null)
    {

        var isImage = UploadImageService.IsImage(Model.PhotoUrl);

        if (isImage == true)
        {
            <div class="row">
                <img src="~/PostsPhotos/@Model.PhotoUrl" class="img-fluid w-75" />
            </div>
        }
        else
        {
            <div class="row">
                <video id="video" controls style="width:60%; height:auto">
                    <source src="~/PostsPhotos/@Model.PhotoUrl" type="video/mp4">
                    <source src="~/PostsPhotos/@Model.PhotoUrl" type="video/ogg">
                    @*Your browser does not support the video tag.*@
                </video>
            </div>
        }

        <div class="row d-flex">
            <div class="col-md-3">
                <button id="index-like-Btn" onclick="clickLike(@Model.PostId)" class="border-0"><i class="far fa-futbol"></i></button>
                <span>
                    <a asp-action="PostLikesList" asp-controller="Post" asp-route-postid="@Model.PostId">
                        @Html.DisplayFor(model => model.NumberOfLikes)&nbsp;Likes
                    </a>
                </span>
            </div>
            <div class="col-md-3">
                <span>@Html.DisplayFor(model => model.DatePostedString)</span>
            </div>
            <div class="col-md-6 text-right">
                @{
                    var postSavedCheck = SavedPostService.SavedCheck(UserManager.GetUserId(User), Model.PostId);
                }
                @if (postSavedCheck == true)
                {
                    <button class="btn-danger" onclick="savePost(@Model.PostId)"><i class="fas fa-bookmark"></i></button>
                }
                else
                {
                    <button class="btn-light" onclick="savePost(@Model.PostId)"><i class="fas fa-bookmark"></i></button>
                }
            </div>
        </div>
        <div class="row d-flex">
            <p>@Html.DisplayFor(model => model.Description)</p>
        </div>
        <div class="row justify-content-center">
            <div class="col-3">
                <a asp-action="MyPostEdit" asp-route-id="@Model.PostId" class="btn btn-secondary">Edit</a>
            </div>
            <div class="col-3">
                <a asp-action="MyPostDetails" asp-route-id="@Model.PostId" class="btn btn-info">Details</a>
            </div>
            <div class="col-3">
                <a asp-action="MyPostDelete" asp-route-id="@Model.PostId" class="btn btn-danger">Delete</a>
            </div>
        </div>
    }
    else
    {
        <div class="row">
            <div class="text-left form-control">
                <h5>@Html.DisplayFor(model => model.Description)</h5>
            </div>
        </div>
        <div class="row">
            <div class="col-md-2 text-left ">
                <button id="index-like-Btn" onclick="clickLike(@Model.PostId)" class="border-0"><i class="far fa-futbol"></i></button>
                <span>
                    <a asp-action="PostLikesList" asp-controller="Post" asp-route-postid="@Model.PostId">
                        @Html.DisplayFor(model => model.NumberOfLikes)&nbsp;Likes
                    </a>
                </span>
            </div>
            <div class="col-md-2 text-left ">
                <span>@Html.DisplayFor(model => model.DatePostedString)</span>
            </div>
            <div class="col-md-8 text-right">
                @{
                    var postSavedCheck = SavedPostService.SavedCheck(UserManager.GetUserId(User), Model.PostId);
                }
                @if (postSavedCheck == true)
                {
                    <button class="btn-danger" onclick="savePost(@Model.PostId)"><i class="fas fa-bookmark"></i></button>
                }
                else
                {
                    <button class="btn-light" onclick="savePost(@Model.PostId)"><i class="fas fa-bookmark"></i></button>
                }
            </div>
        </div>
    }
</div>
<div class="row">
    <a asp-action="AllMyPosts">Back To List</a>
</div>