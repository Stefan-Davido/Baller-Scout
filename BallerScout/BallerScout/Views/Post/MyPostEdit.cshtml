@using Microsoft.AspNetCore.Identity
@using BallerScout.Entities
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@inject BallerScout.Service.ServiceInterfaces.IUploadImageService UploadImageService
@inject BallerScout.Service.ServiceInterfaces.ISavedPostService SavedPostService
@inject BallerScout.Service.ServiceInterfaces.ILikeService LikeService
 
@model BallerScout.Models.PostModel

<div class="container">
    <div class="row">
        <div class="col-12 text-center">
            <h2>Edit Post</h2>
            <hr />
        </div>
    </div>
    <form asp-action="MyPostEdit" method="post">
        <div class="col-12 text-center p-5">
            <div class="row d-flex text-center w-75">
                <img src="~/ProfilePhotos/@Model.UserProfilePhoto" class="profile-img " />
                @if (UserManager.GetUserId(User) == @Model.UserId)
                {
                    <a asp-area="Identity" asp-page="/Account/Manage/Index">@Html.DisplayFor(model => model.UserName)</a>
                }
                else
                {
                    <a asp-action="UserProfile" asp-controller="User" asp-route-id="@Model.UserId">@Html.DisplayFor(model => model.UserName)</a>
                }
            </div>
            @if (Model.PhotoUrl != null)
            {

                var isImage = UploadImageService.IsImage(Model.PhotoUrl);

                if (isImage == true)
                {
                    <div class="row">
                        <img src="~/PostsPhotos/@Model.PhotoUrl" class="img-fluid w-75" />
                    </div>
                }
                else
                {
                    <div class="row">
                        <video id="video" controls style="width:60%; height:auto">
                            <source src="~/PostsPhotos/@Model.PhotoUrl" type="video/mp4">
                            <source src="~/PostsPhotos/@Model.PhotoUrl" type="video/ogg">
                            @*Your browser does not support the video tag.*@
                        </video>
                    </div>
                }

                <div class="row d-flex">
                    <div class="col-md-3">
                        @if (SignInManager.IsSignedIn(User))
                        {
                            var like = LikeService.LikeCheck(Model.PostId, UserManager.GetUserId(User));

                            if (like == null)
                            {
                                <button id="index-like-Btn" onclick="clickLike(@Model.PostId)" class="border-0 btn-danger"><i class="far fa-futbol"></i></button> }
                            else
                            {
                                <button id="index-like-Btn" onclick="clickLike(@Model.PostId)" class="border-0 btn-success"><i class="far fa-futbol"></i></button> }
                        }
                        else
                        {
                            <a id="index-like-Btn" asp-area="Identity" asp-page="/Account/Login" class="border-0 btn-danger"><i class="far fa-futbol"></i></a>
                        }
                        <span>
                            <a asp-action="PostLikesList" asp-controller="Post" asp-route-postid="@Model.PostId">
                                @Html.DisplayFor(model => model.NumberOfLikes)&nbsp;Likes
                            </a>
                        </span>
                    </div>
                    <div class="col-md-3">
                        <span>@Html.DisplayFor(model => model.DatePostedString)</span>
                    </div>
                    <div class="col-md-6 text-right">
                        @{
                            var postSavedCheck = SavedPostService.SavedCheck(UserManager.GetUserId(User), Model.PostId);
                        }
                        @if (postSavedCheck == true)
                        {
                            <button class="btn-danger" onclick="savePost(@Model.PostId)"><i class="fas fa-bookmark"></i></button>
                        }
                        else
                        {
                            <button class="btn-light" onclick="savePost(@Model.PostId)"><i class="fas fa-bookmark"></i></button>
                        }
                    </div>
                </div>
                <div class="row d-flex">
                    <input type="text" asp-for="@Model.Description" value="@Model.Description" >
                </div> 
            }
            else
            {
                <div class="row">
                    <div class="text-left form-control">
                        <h5>@Html.DisplayFor(model => model.Description)</h5>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-2 text-left ">
                        @if (SignInManager.IsSignedIn(User))
                        {
                            var like = LikeService.LikeCheck(Model.PostId, UserManager.GetUserId(User));

                            if (like == null)
                            {
                                <button id="index-like-Btn" onclick="clickLike(@Model.PostId)" class="border-0 btn-danger"><i class="far fa-futbol"></i></button> }
                            else
                            {
                                <button id="index-like-Btn" onclick="clickLike(@Model.PostId)" class="border-0 btn-success"><i class="far fa-futbol"></i></button> }
                        }
                        else
                        {
                            <a id="index-like-Btn" asp-area="Identity" asp-page="/Account/Login" class="border-0 btn-danger"><i class="far fa-futbol"></i></a>
                        }
                        <span>
                            <a asp-action="PostLikesList" asp-controller="Post" asp-route-postid="@Model.PostId">
                                @Html.DisplayFor(model => model.NumberOfLikes)&nbsp;Likes
                            </a>
                        </span>
                    </div>
                    <div class="col-md-2 text-left ">
                        <span>@Html.DisplayFor(model => model.DatePostedString)</span>
                    </div>
                    <div class="col-md-8 text-right">
                        @{
                            var postSavedCheck = SavedPostService.SavedCheck(UserManager.GetUserId(User), Model.PostId);
                        }
                        @if (postSavedCheck == true)
                        {
                            <button class="btn-danger" onclick="savePost(@Model.PostId)"><i class="fas fa-bookmark"></i></button>
                        }
                        else
                        {
                            <button class="btn-light" onclick="savePost(@Model.PostId)"><i class="fas fa-bookmark"></i></button>
                        }
                    </div>
                </div>
            }
            <div class="row mt-2">
                <div class="col-12">
                    <input type="submit" class=" btn btn-primary" value="EDIT">
                </div>
            </div>
        
            <div class="row">
                <input type="hidden" asp-for="DatePosted" class="form-control" />
                <input type="hidden" asp-for="DatePostedString" class="form-control" />
                <input type="hidden" asp-for="NumberOfLikes" class="form-control" />
                <input type="hidden" asp-for="PhotoUrl" class="form-control" />
                <input type="hidden" asp-for="UserName" class="form-control" />
                <input type="hidden" asp-for="UserProfilePhoto" class="form-control" />
                <input type="hidden" asp-for="UserId" class="form-control">
                <input type="hidden" asp-for="PostId" class="form-control">
            </div>
        </div>
    </form>
</div>

<div class="row">
    <div class="col-12">
        <a asp-action="AllMyPosts">Back to List</a>
    </div>
</div> 

